# ==========================================
# Docker Compose 配置
# ==========================================
# Docker Compose 是什么？
#   如果 Dockerfile 是"打包一个容器"，
#   Docker Compose 就是"编排多个容器一起运行"的工具。
#   虽然我们目前只有一个服务，但用 Compose 的好处是：
#     - 一句 docker compose up 启动所有东西
#     - 配置集中管理，不用记长长的 docker run 命令
#
# 使用方法：
#   启动：docker compose up --build -d
#   查看日志：docker compose logs -f
#   停止：docker compose down
# ==========================================

services:
  api:
    # 使用当前目录的 Dockerfile 构建镜像
    build: .
    # 端口映射：宿主机 8000 → 容器 8000
    ports:
      - "8000:8000"
    # 环境变量（覆盖 .env 中的配置）
    environment:
      - APP_NAME=Todo API
      - APP_VERSION=0.1.0
      - DEBUG=false
      - DATABASE_URL=sqlite+aiosqlite:///./data/todo.db
    # 数据持久化：把容器内的 /app/data 目录挂载到 Docker volume
    # 这样即使容器删除重建，数据库文件也不会丢失
    volumes:
      - todo-data:/app/data

# 定义命名 volumes
volumes:
  todo-data:
